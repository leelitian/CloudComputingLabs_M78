package client;

import okhttp3.*;

import java.io.IOException;

/**
 * @author csqure
 * è¿™æ˜¯ä¸?ä¸ªåŸºäºŽOKhttpçš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥æµ‹è¯•å¯¹æœåŠ¡å™¨çš„HTTPè¿žæŽ¥è¯·æ±‚
 */
public class MyOkHttpClient {
    /**å”¯ä¸€ä¸?ä¸ªå®¢æˆ·ç«¯å¯¹è±¡ï¼Œä½¿ç”¨å®ƒæ¥è¿›è¡Œå‘é€HTTPè¯·æ±‚*/
    final static OkHttpClient client=new OkHttpClient();

    /**
     * è¿™æ˜¯GETæ–¹æ³•çš„è°ƒç”?
     * @param url æ‰?è¾“å…¥çš„URLåœ°å€
     * */
    public static void GetMethod(String url){
        /**æž„å»ºHTTPè¯·æ±‚ï¼Œé»˜è®¤ä¸ºGETæ–¹æ³•
         * */
        Request request=new Request.Builder()
                .url(url)
                .build();
        /**è°ƒç”¨å‡†å¤‡
         * */
        Call call=client.newCall(request);
        try {
            /**æ‰§è¡Œå¹¶è¿”å›žç»“æž?
             * */
            Response response=call.execute();
            /**è¿”å›žçš„æ˜¯å›žåº”å¤´å’Œå›žåº”ä½?*/
            System.out.println(response.headers()+"\n"+response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    /**è¿™æ˜¯postæ–¹æ³•
     * @param url è¦è¯·æ±‚çš„ç½‘å€
     * @param name ç”¨æˆ·åå­—
     * @param id ç”¨æˆ·id*/
    public static void PostMethod(String url,String name,String id){
        /**POSTæ–¹æ³•è¦æž„é€ è¯·æ±‚ä½“ï¼Œä½¿ç”¨è¿™ç§ç®€å•çš„æ–¹æ³•å°±è¡Œ
         * .add(key,value)
         * è¿™ä»£è¡¨ç€xxxxx.com/?key=value
         * */
        RequestBody formBody = new FormBody.Builder()
                .add("Name", name)
                .add("ID", id)
                .build();
        /**è¿™æ˜¯å¯¹è¯·æ±‚çš„æž„é??
         * .post(RequestBody)æž„é? äº†POSTæ–¹æ³•
         * */
        Request request = new Request.Builder()
                .url(url)
                .post(formBody)
                .build();

        Call call = client.newCall(request);
        try {
            Response response=call.execute();
            /**è¿”å›žçš„æ˜¯å›žåº”å¤´å’Œå›žåº”ä½?*/
            System.out.println(response.headers()+"\n"+response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void PutMethod(String url){
        FormBody body = new FormBody.Builder()
                .add("communityId", String.valueOf(123))
                .build();
        /**æž„å»ºHTTPè¯·æ±‚ï¼Œé»˜è®¤ä¸ºGETæ–¹æ³•
         * */
        Request request=new Request.Builder()
                .url(url)
                .put(body)
                .build();
        /**è°ƒç”¨å‡†å¤‡
         * */
        Call call=client.newCall(request);
        try {
            /**æ‰§è¡Œå¹¶è¿”å›žç»“æž?
             * */
            Response response=call.execute();
            /**è¿”å›žçš„æ˜¯å›žåº”å¤´å’Œå›žåº”ä½?*/
            System.out.println(response.message()+"\n"+response.headers()+"\n");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    public static void main(String[] args) {

//        GetMethod("http://127.0.0.1:7397");
        PostMethod("http://127.0.0.1:7397/Post_show","HNU","cs1024");
//        PutMethod("http://127.0.0.1:7397");

//        ExecutorService pool = Executors.newFixedThreadPool(6);
//        Runnable myThread = () -> {
//            for (int i = 0; i < 100; i++) {
//                System.out.println(i);
//                GetMethod("http://www.baidu.com");
//            }
//        };
//        // å‘çº¿ç¨‹æ± ä¸­æäº¤ä¸¤ä¸ªçº¿ç¨?
//        pool.submit(myThread);
//        pool.submit(myThread);
//        // å…³é—­çº¿ç¨‹æ±?
//        pool.shutdown();
    }
}
